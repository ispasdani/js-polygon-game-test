<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3D Helicopter Game with Hills and Polygon Helicopter</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }

    canvas {
      display: block;
      margin: 0 auto;
      background: #87CEEB;
    }
  </style>
</head>

<body>
  <canvas id="game" width="800" height="600"></canvas>

  <script>
    // --- Utility to draw a filled polygon ---
    function drawPolygon(ctx, points, color) {
      ctx.beginPath();
      ctx.moveTo(points[0].x, points[0].y);
      for (let i = 1; i < points.length; i++) ctx.lineTo(points[i].x, points[i].y);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();
      ctx.strokeStyle = '#000';
      ctx.stroke();
    }

    // --- Setup Canvas ---
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const d = 400; // projection distance

    // --- Hills as 3D objects ---
    const hills = [
      { x: -200, z: 50, radius: 150, color: '#2E8B57' },
      { x: 300, z: 80, radius: 200, color: '#2E8B57' }
    ];

    // --- Game state variables ---
    let heliPos = { x: 0, y: 0, z: 5 };
    let heliAngle = 0;

    // --- Projection and Rotation (for hills) ---
    function project(v) {
      const scale = d / (v.z + d);
      return { x: v.x * scale + width / 2, y: -v.y * scale + height / 2, scale };
    }

    // --- Draw Hills with perspective and rotation ---
    function drawHills() {
      hills.forEach(hill => {
        let relX = hill.x - heliPos.x;
        let relZ = hill.z - heliPos.z;
        const cosA = Math.cos(-heliAngle), sinA = Math.sin(-heliAngle);
        const wx = relX * cosA - relZ * sinA;
        const wz = relX * sinA + relZ * cosA;
        const world = { x: wx, y: -1, z: wz };
        const p = project(world);
        if (world.z > -d + 1) {
          ctx.beginPath();
          ctx.arc(p.x, p.y, hill.radius * p.scale, Math.PI, 0, false);
          ctx.lineTo(p.x + hill.radius * p.scale, height);
          ctx.lineTo(p.x - hill.radius * p.scale, height);
          ctx.closePath();
          ctx.fillStyle = hill.color;
          ctx.fill();
        }
      });
    }

    // --- Draw 2D Helicopter at screen center using polygons ---
    function drawHelicopter2D() {
      const cx = width / 2, cy = height / 2;
      // Body (rectangle)
      const body = [
        { x: cx - 20, y: cy + 5 }, { x: cx + 20, y: cy + 5 },
        { x: cx + 20, y: cy - 5 }, { x: cx - 20, y: cy - 5 }
      ];
      drawPolygon(ctx, body, '#FFD700');
      // Rotor (top)
      const rotor = [
        { x: cx - 30, y: cy - 5 }, { x: cx + 30, y: cy - 5 },
        { x: cx + 30, y: cy - 8 }, { x: cx - 30, y: cy - 8 }
      ];
      drawPolygon(ctx, rotor, '#555');
      // Tail (triangle)
      const tail = [
        { x: cx + 20, y: cy + 2 }, { x: cx + 50, y: cy + 2 },
        { x: cx + 20, y: cy - 2 }
      ];
      drawPolygon(ctx, tail, '#FFD700');
    }

    // --- Main Loop ---
    function loop() {
      ctx.clearRect(0, 0, width, height);
      // Draw background hills and ground
      drawHills();
      ctx.fillStyle = '#228B22';
      const groundY = project({ x: 0, y: -1, z: -heliPos.z }).y;
      ctx.fillRect(0, groundY, width, height - groundY);
      // Draw helicopter overlay
      drawHelicopter2D();
      requestAnimationFrame(loop);
    }

    // --- Input Handling ---
    window.addEventListener('keydown', e => {
      const speed = 1;
      const turn = 0.05;
      const forwardX = Math.sin(heliAngle) * speed;
      const forwardZ = Math.cos(heliAngle) * speed;
      if (e.key === 'ArrowUp') { heliPos.x += forwardX; heliPos.z += forwardZ; }
      if (e.key === 'ArrowDown') { heliPos.x -= forwardX; heliPos.z -= forwardZ; }
      if (e.key === 'ArrowLeft') { heliAngle -= turn; }
      if (e.key === 'ArrowRight') { heliAngle += turn; }
    });

    loop();
  </script>
</body>

</html>